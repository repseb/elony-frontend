<!DOCTYPE html>
<head>

    <!-- CSS -->
    <link rel="stylesheet" href="stylesheet.css">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>

    <title>Elon Twitter Detail</title>
    <script>
        // Function to fetch tweet content and populate the page
        function loadTweetContent(tweet_id) {
            fetch("/tweet/" + tweet_id) // Fetch tweet details from the backend
            .then(r => r.json()) // Parse the JSON response
            .then(d => {
                if (d.success && d.tweetContent) {
                    // Dynamically update the tweet content
                    document.getElementById("tweetContent").innerText = d.tweetContent;
                } else {
                    // Handle error if tweet not found
                    document.getElementById("tweetContent").innerText = "Tweet not found.";
                }
            })
            .catch(err => {
                console.error("Error fetching tweet:", err);
                document.getElementById("tweetContent").innerText = "Failed to load tweet.";
            });
        }

        // On page load, fetch the tweet content based on the tweet ID
        window.onload = function() {
            const tweetId = document.getElementById("tweetId").value; // Get tweet ID
            loadTweetContent(tweetId); // Load the tweet content
        }

        // Function to save the tweet by sending a request to the save route
        function saveTweet(tweet_id) {
            // Use the Fetch API to send a POST request to the save route
            fetch("/tweet/save_by_id?tweet_id=" + tweetId, { 
                method: "POST", 
            })
            .then(r => r.json())
            .then(d => {
                // If the response is successful, show an alert
                if (d.success) {
                    alert("Tweet opgeslagen!");
                } else {
                    alert("Oeps. Er ging iets fout bij het opslaan. Probeer het opnieuw.");
                }
            })
            .catch(er => {
                console.error("Error:", err);
                alert("Error.");
            });
        }

        // Function to check if the tweet has been saved
        function checkIfSaved(tweet_id) {
            fetch("/tweet/check_if_saved?tweet_id=" + tweet_id)
            .then(r => r.json())
            .then(d => {
                // Display the result to the user
                if (d.saved) {
                    document.getElementById('saveStatus').innerText = "Je hebt deze tweet opgeslaan!";
                } else {
                    document.getElementById('saveStatus').innerText = "Je hebt deze tweet niet opgeslaan.";
                }
            })
            .catch(err => {
                console.error('Error:', err);
                alert('Error.');
            });
        }

        // Initialize the page to check if the tweet is already saved
        window.onload = function() {
            const tweetId = document.getElementById('tweetId').value;
            checkIfSaved(tweetId);  // Check if the tweet is already saved on page load
        }
    </script>
</head>
<body>
    <h1>Tweet Detail</h1>
    
    <!-- Assuming you have a tweetId available on your page -->
    <input type="hidden" id="tweetId" value="12345"> <!-- Example Tweet ID -->

    <div>
        <h2>Tweet Content:</h2>
        <p id="tweetContent">Tweet aan het laden...</p> <!-- This would be dynamically populated -->
    </div>

    <button onclick="saveTweet(document.getElementById('tweetId').value)">Bewaar</button>
    
    <!-- This will show the save status -->
    <p id="saveStatus"></p>

</body>
</html>
